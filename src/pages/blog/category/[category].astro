---
import { getCollection } from "astro:content";
import Pagination from "@components/blog/pagination.astro";
import Posts from "@components/blog/posts.astro";
import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "i18next";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const languages = ["en", "it", "fr", "de", "es", "hi", "ar", "id", "ru", "pt", "ko", "tl", "nl", "ms", "tr"]; // Configure in astro-i18next

  return languages.flatMap((lang) => {
    const langPosts = posts.filter(post => 
      post.slug.startsWith(`${lang}/`) && 
      !post.data.draft &&
      post.data.publishDate < new Date()
    );

    const categories = new Set(
      langPosts
        .map(post => post.data.category?.toLowerCase())
        .filter(Boolean)
    );

    return Array.from(categories).map(category => ({
      params: { category, lang },
      props: {
        posts: langPosts.filter(post => 
          post.data.category?.toLowerCase() === category
        ),
        category,
        lang
      }
    }));
  });
}

const { posts = [], category, lang } = Astro.props;
if (!category) return new Response(null, { status: 404 });
---

<Layout title={`${t("mics.category_title1")} ${category} ${t("mics.category_title2")}`} lang={lang}>
  <Container>
    <Sectionhead>
      <Fragment slot={`${t("mics.category_title1")} ${category} ${t("mics.category_title2")}`} />
      <Fragment slot="desc">{`${t("mics.category_desc")} ${category} ${t("mics.category_desc2")}`}</Fragment>
    </Sectionhead>
    <Posts posts={posts} />
  </Container>
</Layout>