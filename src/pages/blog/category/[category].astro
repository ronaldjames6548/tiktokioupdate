---
import { getCollection } from "astro:content";

// Fetch all blog posts
const posts = await getCollection("blog", ({ data }) => {
  return !data.draft && data.publishDate < new Date();
});

// Filter by current language (based on folder structure)
const lang = "ar"; // because this file is in /ar/
const localizedPosts = posts.filter((post) => {
  const [postLang] = post.slug.split("/");
  return postLang === lang;
});

// Get unique categories from localized posts
const categories = new Set(
  localizedPosts
    .map((post) => post.data.category?.toLowerCase())
    .filter(Boolean)
);

// Generate paths for each category
export async function getStaticPaths() {
  return Array.from(categories).map((category) => ({
    params: { category },
    props: {
      posts: localizedPosts.filter(
        (post) =>
          typeof post.data.category === "string" &&
          post.data.category.toLowerCase() === category
      ),
      category,
      lang,
    },
  }));
}
---

<!-- Now use the props passed via getStaticPaths -->
<Layout title={`Category: ${category}`} lang={lang}>
  <Container>
    <h1>Category: {category}</h1>
    <Posts posts={posts} />
  </Container>
</Layout>